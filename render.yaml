# Render Infrastructure as Code for Snoball Trading Platform
services:
  # Main Trade Server - WebSocket connections to Alpaca
  - type: web
    name: snoball-prod-trade-server
    runtime: docker
    dockerfilePath: ./apps/trade-server/Dockerfile.render
    plan: starter
    region: ohio # Central US for optimal trading latency
    branch: main

    # Auto-deploy on git push
    autoDeploy: true

    # Health check configuration
    healthCheckPath: /health

    # Environment variables (Dockerfile handles service type detection)
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 9090
      - key: ENVIRONMENT
        value: production

    # Scaling configuration
    numInstances: 1

  # Background Worker for Order Processing
  - type: worker
    name: snoball-prod-worker
    runtime: docker
    dockerfilePath: ./apps/trade-server/Dockerfile.render
    plan: starter
    region: ohio
    branch: main

    autoDeploy: true

    envVars:
      - key: NODE_ENV
        value: production
      - key: ENVIRONMENT
        value: production
      - key: WORKER_TYPE
        value: order_processor

    numInstances: 1

  # Cron Job for Market Analysis
  - type: cron
    name: snoball-prod-analysis
    runtime: docker
    dockerfilePath: ./apps/trade-server/Dockerfile.render
    plan: starter
    region: ohio
    branch: main

    schedule: "*/30 * * * *" # Every 30 minutes during market hours

    envVars:
      - key: NODE_ENV
        value: production
      - key: ENVIRONMENT
        value: production
      - key: JOB_TYPE
        value: market_analysis

  # Redis Cache (using Render's native Redis)
  - type: redis
    name: snoball-prod-redis
    plan: starter
    region: ohio

    # Redis configuration
    maxmemoryPolicy: allkeys-lru

    # Access control
    ipAllowList: [] # Will be set to services automatically

# Database configuration (external - PlanetScale)
# Set DATABASE_URL in environment variables

# Notifications are configured in the Render dashboard:
# Dashboard → Service → Settings → Notifications
# Available notification types: email, Slack, Discord, webhook
